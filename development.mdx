---
title: "Development"
description: "Set up your local development environment"
---

## Development Setup

```bash
# Install dependencies
pnpm install

# Run in watch mode (auto-restarts on changes)
pnpm dev

# Type checking
pnpm type-check

# Linting (ESLint + Biome)
pnpm lint

# Auto-fix lint issues
pnpm lint:fix

# Clean and reinstall dependencies
pnpm clean
```

## Code Standards

<Warning>
These standards are strictly enforced. The codebase uses strict TypeScript mode.
</Warning>

### Never Use `any`

```typescript
// ❌ Bad
function process(data: any) { ... }

// ✅ Good
function process(data: TranscriptData) { ... }
```

### Never Use Type Assertions

```typescript
// ❌ Bad
const result = response as CardData;

// ✅ Good - Use Zod validation
const result = cardDataSchema.parse(response);
```

### Enforce Immutability

```typescript
// ❌ Bad
interface Config {
  name: string;
  tags: string[];
}

// ✅ Good
interface Config {
  readonly name: string;
  readonly tags: ReadonlyArray<string>;
}
```

### Use Zod for Runtime Validation

```typescript
import { Schema } from "effect";

const cardSchema = Schema.Struct({
  front: Schema.String,
  back: Schema.String,
  tags: Schema.Array(Schema.String),
});

// Validate at system boundaries
const card = Schema.decodeUnknownSync(cardSchema)(rawData);
```

## Project Structure

```
src/
├── index.ts              # CLI entry point (Commander.js)
├── config.ts             # Configuration constants
├── auth/                 # Google OAuth2 flow
├── commands/             # CLI command implementations
│   ├── generate.ts       # Main pipeline orchestrator
│   ├── review.ts         # Interactive SRS session
│   ├── list.ts           # List/filter cards
│   ├── stats.ts          # Statistics dashboard
│   └── delete.ts         # Card deletion
├── modes/                # Processing mode configurations
│   ├── cooking.ts        # Cooking mode
│   └── types.ts          # Tag schema helper
├── pipeline/             # Pipeline execution
│   ├── types.ts          # PipelineContext, PipelineModule
│   └── runner.ts         # Module execution
├── modules/              # Pipeline modules
│   ├── sources/          # Input sources
│   └── processors/       # Processing stages
├── processing/           # External integrations
│   ├── ffmpeg.ts         # Video→audio conversion
│   ├── transcriber.ts    # WhisperX integration
│   └── pyannote.ts       # Pyannote cloud API
├── photos/               # Google Photos Picker
├── srs/                  # Spaced repetition
│   ├── card-id.ts        # SHA256 card ID generation
│   ├── database.ts       # Database operations
│   ├── scheduler.ts      # FSRS integration
│   └── generator.ts      # Gemini card generation
├── types/                # Zod schemas
│   ├── schemas.ts        # API/CLI schemas
│   └── srs-schemas.ts    # SRS schemas
└── utils/
    └── logger.ts         # Chalk + ora
```

## Adding a New Command

1. Create command file in `src/commands/`:

```typescript
// src/commands/my-command.ts
import { loadDatabase } from "../srs/database.js";
import { logger } from "../utils/logger.js";

export async function runMyCommand(options: MyCommandOptions): Promise<void> {
  const db = await loadDatabase(options.databasePath);
  // Command logic
  logger.success("Done!");
}
```

2. Register in `src/index.ts`:

```typescript
program
  .command("my-command")
  .description("Does something useful")
  .option("-x, --example <value>", "Example option")
  .action(runMyCommand);
```

## Testing Locally

```bash
# Run with TypeScript directly (no build needed)
pnpm start -m cooking --help

# Debug mode for verbose output
DEBUG=true pnpm start -m cooking -d 2024-01-15
```

## Key Dependencies

| Package | Purpose |
|---------|---------|
| `commander` | CLI argument parsing |
| `effect` | Type-safe validation and error handling |
| `ts-fsrs` | FSRS scheduling algorithm |
| `@google/genai` | Gemini API client |
| `googleapis` | Google Auth library |
| `chalk` | Terminal colors |
| `ora` | Terminal spinners |
